(window.webpackJsonpchat=window.webpackJsonpchat||[]).push([[0],{53:function(e,t,n){e.exports=n(66)},58:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(8),o=n.n(c),i=(n(58),n(6)),u=n(9),s=(n(59),n(60),function(e){var t=e.messages,n=e.userName,c=e.firstUnreadMessageId,o=e.updateInterlocutor,i=r.a.createRef(),u=r.a.createRef(),s=new Date,l=Object(a.useRef)(!0);Object(a.useEffect)(function(){!c&&l&&i.current.scrollTo(0,i.current.scrollHeight)},[c,i,t]),Object(a.useEffect)(function(){var e=i.current.scrollHeight-i.current.scrollTop===i.current.clientHeight;e||(i.current.scrollTo(0,i.current.scrollHeight-i.current.clientHeight),l.current=e)},[i]),Object(a.useEffect)(function(){c&&u.current&&i.current.scrollTo(0,u.current.offsetTop-20)},[c,u,i]);var m=function(e){var t=e.target.textContent;t!==n&&o(t)};return r.a.createElement("ul",{ref:i,className:"messages-list"},t.map(function(e){var t=function(e){var t=new Date;return e.getDate()===t.getDate()?"today":e.getDate()===t.getDate()-1?"yesterday":e.getDate()}(new Date(e.time));return s!==t?(s=t,r.a.createElement("li",{key:e.id,className:"message-date"},t)):r.a.createElement(a.Fragment,{key:e.id},e.id===c&&r.a.createElement("li",{ref:u,className:"messages-list__new-message"}," new messages "),r.a.createElement("li",{className:"messages-list__item"},r.a.createElement("p",{className:"message-description"},r.a.createElement("span",{className:"message-author ".concat(n===e.from?"message-author--highlighted":""),onClick:m},e.from),r.a.createElement("span",{className:"message-time"},function(e){var t=e.getHours();t<10&&(t="0"+t);var n=e.getMinutes();return n<10&&(n="0"+n),"".concat(t,":").concat(n)}(new Date(e.time)))),r.a.createElement("p",{className:"message-text"},e.message)))}))}),l=n(100),m=n(107),f=n(98),d=n(111),b=(n(61),Object(f.a)(function(e){return Object(d.a)({container:Object(u.a)({display:"flex",alignItems:"center",paddingTop:30,paddingBottom:30,justifyContent:"center",boxSizing:"border-box",width:"100%"},e.breakpoints.down("md"),{flexDirection:"column"}),button:{margin:e.spacing(1),backgroundColor:"#472D74"},input:Object(u.a)({width:"80%"},e.breakpoints.down("md"),{width:"90%"})})})),p=function(e){var t=e.onSubmit,n=e.userName,c=e.interlocutor,o=e.onClearInterlocutor,i=b(),u=Object(a.useRef)(null),s=Object(a.useRef)(null),f=Object(a.useCallback)(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),u.current.dispatchEvent(new Event("submit")))},[]);return r.a.createElement("div",{className:"submit-form__wrapper"},c&&r.a.createElement("span",{className:"interlocutor",onClick:o},c,", "),r.a.createElement("form",{name:"form",ref:u,onSubmit:t,className:i.container},r.a.createElement(l.a,{disabled:!n,type:"text",ref:s,multiline:!0,name:"message",placeholder:"".concat(n?"Type your message...":"Login to type your message"),rowsMax:4,className:i.input,onKeyDown:f,autoFocus:!0}),r.a.createElement(m.a,{disabled:!n,type:"submit",variant:"contained",className:i.button,color:"secondary"},"Submit")))},g=n(106),O=n(109),w=n(104),y=n(103),j=n(102),E=Object(f.a)(function(e){return Object(d.a)({button:Object(u.a)({right:2,marginTop:2,position:"absolute",backgroundColor:"#472D74"},e.breakpoints.down("md"),{wordWrap:"break-word",width:"15%",fontSize:11,margin:0})})});function v(e){var t=e.updateData,n=e.userName,c=E(),o=r.a.useState(!1),u=Object(i.a)(o,2),s=u[0],l=u[1],f=Object(a.useRef)(null),d=function(){l(!1)},b=Object(a.useCallback)(function(){t(document.querySelector("#name").value),l(!1)},[t]),p=Object(a.useCallback)(function(e){13===e.keyCode&&(e.preventDefault(),b())},[b]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{variant:"contained",color:"secondary",onClick:function(){l(!0)},className:c.button},"".concat(n?"Change nickname":"Enter nickname")),r.a.createElement(O.a,{open:s,onClose:d,"aria-labelledby":"form-dialog-title"},r.a.createElement(j.a,{id:"form-dialog-title"},"Type your name"),r.a.createElement(y.a,null,r.a.createElement(g.a,{autoFocus:!0,margin:"dense",id:"name",type:"text",fullWidth:!0,autoComplete:"off",ref:f,onKeyDown:p})),r.a.createElement(w.a,null,r.a.createElement(m.a,{onClick:b,color:"primary"},"OK"),r.a.createElement(m.a,{onClick:d,color:"primary"},"Cancel"))))}var h=n(105),k=n(5),N=n.n(k),S=Object(f.a)(function(e){return Object(d.a)(Object(u.a)({dialog:{width:"25%",marginRight:"auto",marginLeft:"auto"}},e.breakpoints.down("md"),{wordWrap:"break-word",width:"15%",fontSize:11,margin:0}))});function D(e){var t=e.updateShowDisconnectionDialog,n=S(),a=r.a.useState(!0),c=Object(i.a)(a,2),o=c[0],u=c[1],s=function(){u(!1),t(!1)};return r.a.createElement("div",null,r.a.createElement(O.a,{open:o,onClose:s,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",onKeyDown:function(e){13===e.keyCode&&(e.preventDefault(),s())},className:n.dialog},r.a.createElement(y.a,null,r.a.createElement(h.a,{id:"alert-dialog-description"},"Sorry, there are some problems with the connection. Try it later :)")),r.a.createElement(w.a,null,r.a.createElement(m.a,{onClick:s,color:"primary"},"OK"))))}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}p.propTypes={onSubmit:N.a.func};var I=function(e,t){try{return JSON.parse(localStorage.getItem(e))||t}catch(n){return t}},x=function(e,t){var n=I(e,{});n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach(function(t){Object(u.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n,{},t),localStorage.setItem(e,JSON.stringify(n))},T=function(){var e=Object(a.useState)([]),t=Object(i.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(!1),u=Object(i.a)(o,2),l=u[0],m=u[1],f=Object(a.useState)(!1),d=Object(i.a)(f,2),b=d[0],g=d[1],O=Object(a.useState)(null),w=Object(i.a)(O,2),y=w[0],j=w[1],E=Object(a.useState)(""),h=Object(i.a)(E,2),k=h[0],N=h[1],S=Object(a.useRef)(null),C=Object(a.useState)(""),T=Object(i.a)(C,2),P=T[0],R=T[1],_=Object(a.useCallback)(function(e){return N(e)},[]),F=Object(a.useCallback)(function(){return R(null)},[]),L=Object(a.useCallback)(function(e){e.userName&&N(e.userName)},[]);Object(a.useEffect)(function(){var e=I("appstate",{});L(e)},[L]);var H=Object(a.useCallback)(function(){x("appstate",{userName:k})},[k]);Object(a.useEffect)(function(){return window.addEventListener("beforeunload",H),function(){return window.removeEventListener("beforeunload",H)}},[H]),Object(a.useEffect)(function(){var e=function(){S.current=new WebSocket("wss://wssproxy.herokuapp.com"),S.current.onopen=function(){m(!0),g(!1),c([])},S.current.onclose=function(){m(!1)}},t=function(){!function t(){S.current.onclose=Function.prototype,S.current.close(),e();var n=setInterval(function(){1===S.current.readyState&&clearInterval(n),2!==S.current.readyState&&3!==S.current.readyState||(clearInterval(n),t())},3e3)}(),m(!1),g(!0)};return e(),window.addEventListener("offline",t),function(){window.removeEventListener("offline",t)}},[]),Object(a.useEffect)(function(){return S.current.onmessage=function(e){var t=JSON.parse(e.data);t.sort(function(e,t){return e.time-t.time}),document.hidden&&(!function e(){if("granted"===Notification.permission){var t=new Notification("\u0423 \u0432\u0430\u0441 \u043d\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",{tag:"message"});setTimeout(t.close.bind(t),4e3),e.onclick=function(){return window.open("/chat")}}else"denied"!==Notification.permission&&Notification.requestPermission()}(),y||j(t[0].id)),c(function(e){return e.concat(t)})},function(){S.current.onmessage=null}},[y,S.current]),Object(a.useEffect)(function(){document.addEventListener("visibilitychange",function(){document.hidden&&y&&j(null)})},[y]);var J=Object(a.useCallback)(function(e){e.preventDefault();var t=new FormData(e.target).get("message"),n={from:k,message:t};P&&(n.message=P.concat(", ",n.message)),l?S.current.send(JSON.stringify(n)):g(!0),document.querySelector("textarea").value=""},[P,l,k]);return r.a.createElement(r.a.Fragment,null,b&&r.a.createElement(D,{updateShowDisconnectionDialog:function(e){return g(e)}}),r.a.createElement(v,{updateData:_,userName:k}),r.a.createElement("div",{className:"wrapper"},r.a.createElement("h1",{className:"wrapper__title"},"".concat("".concat(k,l?", welcome to the chat!":"! Unfortunately, you are offline!"))),r.a.createElement(s,{userName:k,messages:n,firstUnreadMessageId:y,updateInterlocutor:R}),r.a.createElement(p,{interlocutor:P,online:l,onClearInterlocutor:F,onSubmit:J,userName:k})))};o.a.render(r.a.createElement(T,null),document.getElementById("root"))}},[[53,1,2]]]);
//# sourceMappingURL=main.f90659bc.chunk.js.map