(window.webpackJsonpchat=window.webpackJsonpchat||[]).push([[0],{54:function(e,t,n){e.exports=n(66)},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(8),o=n.n(c),i=(n(59),n(6)),u=n(9),s=(n(60),n(61),function(e){var t=e.messages,n=e.userName,c=e.firstUnreadMessageId,o=r.a.createRef(),u=r.a.createRef(),s=new Date,l=Object(a.useRef)(!0),m=Object(a.useState)(""),f=Object(i.a)(m,2),d=f[0],b=f[1];Object(a.useEffect)(function(){!c&&l&&o.current.scrollTo(0,o.current.scrollHeight)},[c,o,t]),Object(a.useEffect)(function(){var e=o.current.scrollHeight-o.current.scrollTop===o.current.clientHeight;e||(o.current.scrollTo(0,o.current.scrollHeight-o.current.clientHeight),l.current=e)},[o]),Object(a.useEffect)(function(){c&&u.current&&o.current.scrollTo(0,u.current.offsetTop-20)},[c,u,o]);var g=function(e){var t=e.target.textContent;t!==n&&b(t)};return r.a.createElement(r.a.Fragment,null,d&&r.a.createElement("span",{className:"interlocutor"},d,","),r.a.createElement("ul",{ref:o,className:"messages-list"},t.map(function(e){var t=function(e){var t=new Date;return e.getDate()===t.getDate()?"today":e.getDate()===t.getDate()-1?"yesterday":e.getDate()}(new Date(e.time));return s!==t?(s=t,r.a.createElement("li",{key:e.id,className:"message-date"},t)):r.a.createElement(a.Fragment,{key:e.id},e.id===c&&r.a.createElement("li",{ref:u,className:"messages-list__new-message"}," new messages "),r.a.createElement("li",{className:"messages-list__item"},r.a.createElement("p",{className:"message-description"},r.a.createElement("span",{className:"message-author ".concat(n===e.from?"message-author--highlighted":""),onClick:g},e.from),r.a.createElement("span",{className:"message-time"},function(e){var t=e.getHours();t<10&&(t="0"+t);var n=e.getMinutes();return n<10&&(n="0"+n),"".concat(t,":").concat(n)}(new Date(e.time)))),r.a.createElement("p",{className:"message-text"},e.message)))})))}),l=n(99),m=n(106),f=n(97),d=n(110),b=Object(f.a)(function(e){return Object(d.a)({container:Object(u.a)({display:"flex",alignItems:"center",paddingTop:30,paddingBottom:30,justifyContent:"center",boxSizing:"border-box",width:"100%"},e.breakpoints.down("md"),{flexDirection:"column",paddingLeft:0}),button:{margin:e.spacing(1),backgroundColor:"#472D74"},input:Object(u.a)({width:"80%"},e.breakpoints.down("md"),{width:"90%"})})}),g=function(e){var t=e.onSubmit,n=e.userName,c=(e.updateInterlocutor,b()),o=Object(a.useRef)(null),i=Object(a.useRef)(null),u=Object(a.useCallback)(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),o.current.dispatchEvent(new Event("submit")))},[]);return r.a.createElement("form",{name:"form",ref:o,onSubmit:t,className:c.container},r.a.createElement(l.a,{disabled:!n,type:"text",ref:i,multiline:!0,name:"message",placeholder:"".concat(n?"Type your message...":"Login to type your message"),rowsMax:4,className:c.input,onKeyDown:u,autoFocus:!0}),r.a.createElement(m.a,{disabled:!n,type:"submit",variant:"contained",className:c.button,color:"secondary"},"Submit"))},p=n(105),O=n(108),w=n(103),j=n(102),E=n(101),v=Object(f.a)(function(e){return Object(d.a)({button:Object(u.a)({right:2,marginTop:2,position:"absolute",backgroundColor:"#472D74"},e.breakpoints.down("md"),{wordWrap:"break-word",width:"15%",fontSize:11,margin:0})})});function y(e){var t=e.updateData,n=e.userName,c=v(),o=r.a.useState(!1),u=Object(i.a)(o,2),s=u[0],l=u[1],f=Object(a.useRef)(null),d=function(){l(!1)},b=Object(a.useCallback)(function(){t(document.querySelector("#name").value),l(!1)},[t]),g=Object(a.useCallback)(function(e){13===e.keyCode&&(e.preventDefault(),b())},[b]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{variant:"contained",color:"secondary",onClick:function(){l(!0)},className:c.button},"".concat(n?"Change nickname":"Enter nickname")),r.a.createElement(O.a,{open:s,onClose:d,"aria-labelledby":"form-dialog-title"},r.a.createElement(E.a,{id:"form-dialog-title"},"Type your name"),r.a.createElement(j.a,null,r.a.createElement(p.a,{autoFocus:!0,margin:"dense",id:"name",type:"text",fullWidth:!0,autoComplete:"off",ref:f,onKeyDown:g})),r.a.createElement(w.a,null,r.a.createElement(m.a,{onClick:b,color:"primary"},"OK"),r.a.createElement(m.a,{onClick:d,color:"primary"},"Cancel"))))}var h=n(104),k=n(5),N=n.n(k),S=Object(f.a)(function(e){return Object(d.a)(Object(u.a)({dialog:{width:"25%",marginRight:"auto",marginLeft:"auto"}},e.breakpoints.down("md"),{wordWrap:"break-word",width:"15%",fontSize:11,margin:0}))});function D(e){var t=e.updateShowDisconnectionDialog,n=S(),a=r.a.useState(!0),c=Object(i.a)(a,2),o=c[0],u=c[1],s=function(){u(!1),t(!1)};return r.a.createElement("div",null,r.a.createElement(O.a,{open:o,onClose:s,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",onKeyDown:function(e){13===e.keyCode&&(e.preventDefault(),s())},className:n.dialog},r.a.createElement(E.a,{id:"alert-dialog-title"}),r.a.createElement(j.a,null,r.a.createElement(h.a,{id:"alert-dialog-description"},"Sorry, there are some problems with the connection. Try it later :)")),r.a.createElement(w.a,null,r.a.createElement(m.a,{onClick:s,color:"primary"},"OK"))))}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}g.propTypes={onSubmit:N.a.func};var T=function(e,t){try{return JSON.parse(localStorage.getItem(e))||t}catch(n){return t}},x=function(e,t){var n=T(e,{});n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach(function(t){Object(u.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n,{},t),localStorage.setItem(e,JSON.stringify(n))},L=function(){var e=Object(a.useState)([]),t=Object(i.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(!1),u=Object(i.a)(o,2),l=u[0],m=u[1],f=Object(a.useState)(!1),d=Object(i.a)(f,2),b=d[0],p=d[1],O=Object(a.useState)(null),w=Object(i.a)(O,2),j=w[0],E=w[1],v=Object(a.useState)(""),h=Object(i.a)(v,2),k=h[0],N=h[1],S=Object(a.useRef)(null),C=Object(a.useState)(""),L=Object(i.a)(C,2),P=(L[0],L[1]),I=Object(a.useCallback)(function(e){return N(e)},[]),R=Object(a.useCallback)(function(e){return P(e)},[]),F=Object(a.useCallback)(function(e){e.userName&&N(e.userName)},[]);Object(a.useEffect)(function(){var e=T("appstate",{});F(e)},[F]);var H=Object(a.useCallback)(function(){x("appstate",{userName:k})},[k]);Object(a.useEffect)(function(){return window.addEventListener("beforeunload",H),function(){return window.removeEventListener("beforeunload",H)}},[H]),Object(a.useEffect)(function(){var e=function(){var e=new WebSocket("ws://st-chat.shas.tel");return e.onopen=function(){m(!0),p(!1)},e.onclose=function(){m(!1),p(!0)},e};S.current=e();var t=function(){S.current=e()},n=function(){S.current.close()};return window.addEventListener("offline",n),window.addEventListener("online",t),function(){S.current.close(),window.removeEventListener("online",t),window.removeEventListener("offline",n)}},[]),Object(a.useEffect)(function(){S.current.onmessage=function(e){var t=JSON.parse(e.data);t.sort(function(e,t){return e.time-t.time}),document.hidden&&(!function e(){if("granted"===Notification.permission){var t=new Notification("\u0423 \u0432\u0430\u0441 \u043d\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",{tag:"message"});setTimeout(t.close.bind(t),4e3),e.onclick=function(){return window.open("http://localhost:3000/")}}else"denied"!==Notification.permission&&Notification.requestPermission()}(),j||E(t[0].id)),c(function(e){return e.concat(t)})}},[j,S.current]),Object(a.useEffect)(function(){document.addEventListener("visibilitychange",function(){document.hidden&&j&&E(null)})},[j]);var J=Object(a.useCallback)(function(e){e.preventDefault();var t=new FormData(e.target).get("message"),n={from:k,message:t};l?S.current.send(JSON.stringify(n)):p(!0),document.querySelector("textarea").value=""},[l,k]);return r.a.createElement(r.a.Fragment,null,b&&r.a.createElement(D,{updateShowDisconnectionDialog:function(e){return p(e)}}),r.a.createElement(y,{updateData:I,userName:k}),r.a.createElement("div",{className:"wrapper"},r.a.createElement(s,{userName:k,messages:n,firstUnreadMessageId:j}),r.a.createElement(g,{userName:k,onSubmit:J,online:l,updateInterlocutor:R})))};o.a.render(r.a.createElement(L,null),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.cafa12ac.chunk.js.map